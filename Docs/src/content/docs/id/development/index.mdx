---
title: Memulai
description: Dokumentasi untuk memulai pengembangan Corsace.
lastUpdated: 2023-09-15
sidebar:
  order: 1
---

Dokumentasi berikut ditujukan untuk menyiapkan lingkungan pengembangan lokal Corsace.
Proyek ini menggunakan rangkaian teknologi berikut:

-   [Node.js](https://nodejs.org/en/) (v16.6.0 atau lebih tinggi)
-   [TypeScript](https://www.typescriptlang.org/) (v4.9.4 atau lebih tinggi)
-   [Docker](https://www.docker.com/) (v3.8 atau lebih tinggi)

Paket utama:

-   [TypeORM](https://typeorm.io/) (v0.3.11)
-   [Koa](https://koajs.com/) (v2.13.1)
-   [Discord.js](https://discord.js.org/) (v14.9.0)
-   [Bancho.js](https://bancho.js.org/) (v0.11.3)
-   [Nuxt 2](https://v2.nuxt.com/) (v2.16.3)
-   [Astro/Starlight](https://starlight.astro.build/) (v0.9.1)

Paket lainnya:

-   [Centrifugo](https://centrifugal.dev/)

Untuk menggandakan repositori:

| OS        | Cmd                                                                  |
| --------- | -------------------------------------------------------------------- |
| WSL/Unix  | `git clone https://github.com/Corsace/Corsace`                       |
| Windows\* | `git clone -c core.symlinks=true https://github.com/Corsace/Corsace` |

\*Gunakan hak admin pada konsolmu pada saat menjalankan perintah.

## Instalasi

**Catatan: Pastikan kamu menggunakan node versi 16.6.0 atau lebih tinggi untuk dapat menjalankan berbagai fitur Discord pada repositori ini.**

Instal node-modules:

```
npm i
```

Gandakan `config/default.json` ke `config/user/$USER.json`, dengan `$USER` merupakan nama pengguna sistem [(yang dapat kamu akses melalui `process.env.USER` atau `USERNAME` milik node)](https://github.com/tusharmath/node-config-ts#using-files).

Pada terminal, jalankan `node` dan ketik `process.env.USER` untuk mencari tahu nama penggunamu.

Ke depannya, dokumentasi ini akan merujuk pada nilai `config/user/$USER.json` personal pada berkas config milikmu dengan istilah `config`.

### API osu!

`config.osu.v1.apiKey`

Kamu dapat memperoleh kunci API osu! V1 kamu [di sini](https://osu.ppy.sh/p/api/).

```
config.osu.v2.clientId
config.osu.v2.clientSecret
```

You will need to create a "New OAuth Application" at the bottom of https://osu.ppy.sh/home/account/edit.

Add `config.corsace.publicUrl + /api/login/osu/callback` to the `Application Callback URLs` section in the popup.

For example, if your `config.corsace.publicUrl` is `http://localhost:5000`, then the callback URL should be `http://localhost:5000/api/login/osu/callback`.

Afterwards, you will be given a `Client ID` and `Client Secret` which you will need to add to your config to the respective fields.

```
config.osu.bancho
```

You can obtain your osu IRC password from the same place as the osu OAuth Application at https://osu.ppy.sh/home/account/edit#irc.

If your account is a bot account, then make sure to have `botAccount` set to true; otherwise, make set it to false.

### Database

`config.database`

#### Setup

There are 2 ways to setup the database, either via Docker or manually.

##### Via Docker (Recommended)

We are shipping a production-like `docker-compose.yml` file. You can start only the database service using: `docker-compose up -d database` or `npm run database`.

The database will listen on `127.0.0.1:3306`, with `corsace` being the database name, username and password.

##### Manual MariaDB Setup

If you do not want to use Docker, you will need to install [MariaDB](https://mariadb.org/) and create an empty database, named whatever you like. 

It can be as simple as running:

```
mysql -u root -p
MySQL> create database <new_db_name>; 
```

Make sure to update `config.database` to reflect your choice of database name and credentials.

#### Seeding the database

Seed the whole Corsace database using: `NODE_ENV=development npm run -- typeorm migration:run -d ormconfig`

### Object Storage/S3

We use S3-compatible object storage for storing and serving mappacks, configured in `config.s3`.

While we target Cloudflare R2, any S3 provider should work as long as they support multipart uploads and pre-signed URLs.

We use three buckets:

-   `team-avatars` is a public bucket that stores team avatars, can be served by a CDN without authentication
-   `mappacks` is a public bucket that stores public mappacks, can be served by a CDN without authentication
-   `mappacks-temp` is a private bucket that stores private mappacks that should not have public access\
    Generated mappacks are first uploaded to this bucket, users are given access through pre-signed URLs.\
    Private mappacks are not meant to be permanently stored, a lifecycle policy should be added to that bucket to automatically delete objects after 1 day.\
    Mappacks that should become public get moved to the `mappacks` bucket.

#### Cloudflare R2

Go to the [Cloudflare R2 dashboard page](https://dash.cloudflare.com/?to=/:account/r2). Enable your plan if you haven't already (good luck exceeding free limits).

Create the `mappacks` and `team-avatars` buckets and enable their R2.dev subdomains, or associate a custom domain for each.

Create the `mappacks-temp` bucket and add an object lifecycle rule to delete objects after 7 days (leave prefix empty).

Set hostname to `<cloudflare account id>.r2.cloudflarestorage.com`, and obtain S3 credentials from https://dash.cloudflare.com/?to=/:account/r2/api-tokens. **Make sure you give the token `Edit` permissions instead of the default `Read` permissions.**

### Discord

`config.discord`

#### Setup

This is the most time-consuming part of the setup. 
You will need the following:

##### Aktifkan Developer Mode

Centang opsi yang terdapat pada 

```
User Settings > Appearance > Advanced > Developer Mode
```

Opsi ini akan memungkinkan kamu untuk mengklik kanan ID pengguna, role, channel, dan lain sebagainya dan menyalin ID mereka.

##### Server Discord

Buat server Discord baru apabila kamu belum memiliki server. Proses ini hanya akan memerlukan satu channel.
Buat role "staff" dan berikan role ini kepada dirimu sendiri.

Klik kanan nama servermu dan pilih "Copy ID". Salin ID ini ke `config.discord.guild`.

Klik kanan role staff-mu dan klik "Copy ID". Kamu dapat membuat role untuk berbagai kebutuhan pada config, ATAU 
kamu juga dapat menyalin ID role ini pada baris config berikut untuk memberikanmu kuasa penuh akan segala sesuatunya.

```
config.discord.roles.corsace.corsace
config.discord.roles.corsace.core
config.discord.roles.corsace.headStaff
config.discord.roles.corsace.staff
```

yang dilanjutkan dengan menyalin ID kamu pada seluruh role "staff" lainnya pada config.

##### Aplikasi Discord

Tuju https://discord.com/developers/applications dan buat aplikasi baru melalui menu "New Application".

###### Klien

Kamu akan perlu untuk menambahkan "Client ID" dan "Client Secret" kepada config sebagai berikut:

```
discord: {
    ...,
    clientId: "<Client ID>",
    clientSecret: "<Client Secret>",
}
```

###### OAuth2

Tuju bagian OAuth2 pada bot dan tambahkan URL redirect berikut:

```
config.corsace.publicUrl + /api/login/discord/callback
```

Tambahkan juga URL redirect yang menyertakan Client ID spesifik milik bot-mu dengan format sebagai berikut:

```
https://discordapp.com/oauth2/authorize?&client_id=<CLIENT ID>&scope=bot&permissions=8
```

Ikuti tautan ini untuk menambahkan bot milikmu ke dalam server.

###### Bot

Tuju bagian Bot dan salin token bot milikmu. 
Sisipkan token tersebut pada `config.discord.token`.

Pastikan kamu telah mencentang `Server Members` dan `Message Content` pada daftar pilihan yang tersedia pada menu **Privileged Gateway Intents** sebelum memulai bot. Apabila tidak, bot kamu tidak akan berjalan dan kamu akan dihadapkan dengan pesan error `[DISALLOWED INTENTS]`.

###### Webhook GitHub

Langkah ini sepenuhnya opsional, dan hanya akan berguna apabila kamu benar-benar ingin melacak rekam jejak aktivitas fork GitHub milikmu di Discord dan memanfaatkan webhook GitHub milik Corsace.

Pada channel Discord yang ingin kamu gunakan sebagai tempat untuk menerima notifikasi, buat webhook baru melalui `Settings -> Integrations -> Create Webhook`, salin URL webhook tersebut, dan sisipkan pada `config.github.webhookUrl` di configmu.
Buat kata sandi dan tempatkan kata sandi ini pada `config.github.webhookSecret`.

Pada Github, tuju pengaturan repositori dan buat webhook baru. Tulis URL berikut pada kolom yang tersedia:

```
config.corsace.publicUrl + /api/github
```

Tentukan tipe konten ke `application/json` beserta dengan secret webhook milik kata sandi yang kamu buat sebelumnya.

### Centrifugo

Kami menggunakan Centrifugo untuk menampilkan notifikasi secara real-time. Kamu dapat menemukan dokumentasi seputar Centrifugo [di sini](https://centrifugal.dev/docs/getting-started/introduction).

#### Pengaturan

Pada Unix:
Jalankan perintah `npm run centrifugo` untuk memulai server Centrifugo. Secara default, server ini akan tersedia pada `http://localhost:8001` selama kamu tidak mengubah nilai port pada berkas konfigurasi.

Pada WSL/Windows ATAU apabila metode di atas tidak bekerja:
Instal berkas biner (.exe) dari [daftar rilisan terbaru](https://github.com/centrifugal/centrifugo/releases) dan tambahkan ke folder root proyek ini.
Setelahnya, jalankan perintah `npm run centrifugo:local` untuk memulai server Centrifugo. Apabila kamu ingin mengubah nomor port yang digunakan, ubah nilai parameter '-p' pada script yang terkait di berkas `package.json` dan URL API config milikmu.
